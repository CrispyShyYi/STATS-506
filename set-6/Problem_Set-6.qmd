---
title: "Problem Set 6"
author: "Jialiang Wu"
format:
  html:
    theme: default
    page-layout: article
    code-fold: true
    code-summary: "Show the code"
    embed-resources: true
editor: visual
---

For source files and data, see my GitHub repo: [STATS-506-Problem-Sets-06](https://github.com/CrispyShyYi/STATS-506-Problem-Sets/tree/main/set-6)

## Problem 1

## Problem 2

### problem 2-a
```{r p2a}

```


### problem 2-b
```{r p2b}

```


### problem 2-c
```{r p2c}

```


## Problem 3

## Problem 4

### load ATP Matches data

```{r setup_question4}
library(data.table)

ATP <- fread("https://raw.githubusercontent.com/JeffSackmann/tennis_atp/refs/heads/master/atp_matches_2019.csv")
```

### problem 4-a

In the ATP Matches dataset, the Davis Cup is recorded differently from regular ATP tournaments. Each Davis Cup tie (e.g., France vs Japan, Spain vs Russia) is assigned its own tourney_id. This means that if we simply count distinct(tourney_id), the Davis Cup will appear as many separate tournaments, which would artificially inflate the number of tournaments in 2019.

To address this, we need to group all tourney_id values that belong to the Davis Cup (those containing "2019-M-DC") and treat them as one single tournament. For the rest of the tournaments, we can safely count distinct tourney_id values directly.

Thus, the total number of tournaments in 2019 is calculated as:

Number of tournaments = distinct non–Davis Cup tourney_ids + 1 (for Davis Cup)

```{r p4a}
# Split into Davis Cup vs others
davis_ids <- unique(ATP[like(tourney_id, "2019-M-DC"), tourney_id])
other_ids  <- unique(ATP[!like(tourney_id, "2019-M-DC"), tourney_id])

# Final tournament count: all others + 1 for Davis Cup
n_tournaments <- length(other_ids) + 1

n_tournaments
```

**Answer:** There are 69 tournaments took place in 2019

### problem 4-b

The Laver Cup (tournament_id: 2019-9210) is a special team exhibition event (Team Europe vs Team World). Unlike standard ATP tournaments, it does not have a single final match (round == “F”) that produces an individual player champion. Also, the Davis Cup is a national team competition, not an individual tournament, which means the winner is the nation’s team, not an individual player. Instead, the winner is a team, determined by cumulative points across multiple singles and doubles matches.

Therefore, for Question 2-b (counting how many players won multiple tournaments and identifying the player(s) with the most titles), the Laver Cup and The Davis Cup should be excluded from the statistics.

```{r p4b}
# Exclude Davis Cup and Laver Cup
ATP_clean <- ATP[!like(tourney_id, "2019-M-DC") & tourney_id != "2019-9210"]

# Tournament winners (Final round winners)
tourney_winners <- unique(
  ATP_clean[round == "F", .(tourney_id, tourney_name, winner_id, winner_name)]
)

# Count titles per player
player_titles <- tourney_winners[, .(num_titles = .N), by = .(winner_id, winner_name)]

# Players with > 1 title
multiple_winners <- player_titles[num_titles > 1]

# display results
n_players_multiple <- nrow(multiple_winners)
max_titles <- max(player_titles$num_titles)

# display results
n_players_multiple
max_titles
```

**Answer:** There are 12 players won more than one tournament, and the most winning player won 5 tournaments.

### problem 4-c

```{r p4c}
# Summarize mean and median aces
aces_summary <- ATP[, .(
  mean_winner_aces  = base::mean(w_ace, na.rm = TRUE),
  mean_loser_aces   = base::mean(l_ace, na.rm = TRUE),
  median_winner_aces = stats::median(w_ace, na.rm = TRUE),
  median_loser_aces  = stats::median(l_ace, na.rm = TRUE)
)]

print(aces_summary)

# reshape long
aces_long <- melt(
  ATP[, .(Winner = w_ace, Loser = l_ace)],
  measure.vars = c("Winner", "Loser"),
  variable.name = "Role",
  value.name = "Aces"
)

library(ggplot2)
ggplot(aces_long, aes(x = Role, y = Aces, fill = Role)) +
  geom_boxplot(na.rm = TRUE) +
  labs(title = "Distribution of Aces: Winners vs Losers (2019)")
```

**Answer:** There is clear descriptive evidence that match winners tend to serve more aces than losers in 2019. While not a formal hypothesis test, the mean, median, and distribution comparisons all point in the same direction.

### problem 4-d

For each player, the win rate = number of matches won / total matches played

```{r pd}
# Wins per player
wins <- ATP[, .(wins = .N), by = winner_name]

# Losses per player
losses <- ATP[, .(losses = .N), by = loser_name]

# merge wins & losses (full join)
player_stats <- merge(wins, losses,
                      by.x = "winner_name", by.y = "loser_name",
                      all = TRUE)

# rename + compute stats
player_stats[, player := winner_name]
player_stats[, winner_name := NULL]

player_stats[is.na(wins), wins := 0]
player_stats[is.na(losses), losses := 0]

player_stats[, total := wins + losses]
player_stats[, win_rate := wins / total]

player_stats <- player_stats[total >= 5]

# top players
top_players <- player_stats[win_rate == max(win_rate, na.rm = TRUE)]

top_players
```

**Answer:** As a result Rafael Nadal has the highest win-rate in tournament 2019.
